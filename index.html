<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>麻雀点数計算</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600;700&family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:        #0d1117;
      --panel:     #161d2b;
      --panel2:    #1c2638;
      --border:    #2a3a52;
      --gold:      #c8a96e;
      --gold2:     #e8cc90;
      --red:       #e05a5a;
      --text:      #d4dbe8;
      --text-dim:  #7a8ba0;
      --accent:    #3a5a8a;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 300;
      min-height: 100vh;
      background-image:
        radial-gradient(ellipse at 20% 20%, rgba(58,90,138,0.15) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 80%, rgba(200,169,110,0.07) 0%, transparent 60%);
    }

    header {
      text-align: center;
      padding: 36px 20px 20px;
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      font-family: 'Noto Serif JP', serif;
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 0.15em;
    }

    header p {
      color: var(--text-dim);
      font-size: 0.78rem;
      margin-top: 4px;
      letter-spacing: 0.1em;
    }

    .container {
      max-width: 760px;
      margin: 0 auto;
      padding: 24px 16px 60px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ---- Section Card ---- */
    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }

    .card-header {
      background: var(--panel2);
      border-bottom: 1px solid var(--border);
      padding: 10px 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-header .dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--gold);
      opacity: 0.7;
    }

    .card-header h2 {
      font-family: 'Noto Serif JP', serif;
      font-size: 0.88rem;
      font-weight: 600;
      color: var(--gold);
      letter-spacing: 0.12em;
    }

    .card-body {
      padding: 16px 18px;
    }

    /* ---- 門前/食い ---- */
    .menzen-row {
      display: flex;
      gap: 10px;
    }

    .radio-btn {
      flex: 1;
      position: relative;
    }

    .radio-btn input {
      position: absolute;
      opacity: 0;
      width: 0;
    }

    .radio-btn label {
      display: block;
      text-align: center;
      padding: 9px;
      border-radius: 6px;
      border: 1px solid var(--border);
      cursor: pointer;
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      transition: all 0.2s;
      background: var(--bg);
    }

    .radio-btn input:checked + label {
      border-color: var(--gold);
      color: var(--gold);
      background: rgba(200,169,110,0.08);
    }

    /* ---- 役グリッド ---- */
    .yaku-section {
      margin-bottom: 14px;
    }

    .yaku-section-title {
      font-size: 0.72rem;
      color: var(--gold);
      letter-spacing: 0.15em;
      margin-bottom: 8px;
      padding-bottom: 5px;
      border-bottom: 1px solid rgba(200,169,110,0.2);
    }

    .yaku-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .yaku-check {
      position: relative;
    }

    .yaku-check input {
      position: absolute;
      opacity: 0;
      width: 0;
    }

    .yaku-check label {
      display: inline-block;
      padding: 5px 11px;
      border-radius: 5px;
      border: 1px solid var(--border);
      background: var(--bg);
      font-size: 0.82rem;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.15s;
      user-select: none;
    }

    .yaku-check input:checked + label {
      border-color: var(--gold);
      color: var(--gold2);
      background: rgba(200,169,110,0.1);
    }

    .yaku-check input:disabled + label {
      opacity: 0.25;
      cursor: not-allowed;
    }

    /* 役満は赤 */
    .yakuman .yaku-check input:checked + label {
      border-color: var(--red);
      color: #f08080;
      background: rgba(224,90,90,0.1);
    }

    /* ---- 翻数表示バー ---- */
    .han-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 7px;
      padding: 10px 16px;
      margin-top: 14px;
    }

    .han-bar .label {
      font-size: 0.78rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
    }

    .han-bar .value {
      font-family: 'Noto Serif JP', serif;
      font-size: 1.1rem;
      color: var(--gold2);
      font-weight: 600;
    }

    .han-bar .yaku-names {
      font-size: 0.75rem;
      color: var(--text-dim);
      margin-top: 2px;
    }

    /* ---- 入力フォーム ---- */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 480px) {
      .form-grid { grid-template-columns: 1fr; }
    }

    .form-item label {
      display: block;
      font-size: 0.75rem;
      color: var(--text-dim);
      letter-spacing: 0.1em;
      margin-bottom: 5px;
    }

    .form-item input[type="number"] {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 0.95rem;
      padding: 9px 12px;
      outline: none;
      transition: border-color 0.2s;
    }

    .form-item input[type="number"]:focus {
      border-color: var(--gold);
    }

    .form-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .toggle-group {
      flex: 1;
      display: flex;
      gap: 6px;
    }

    /* ---- 計算ボタン ---- */
    .calc-btn {
      width: 100%;
      margin-top: 16px;
      padding: 13px;
      background: linear-gradient(135deg, #b8943e, #c8a96e, #b8943e);
      border: none;
      border-radius: 8px;
      color: #0d1117;
      font-family: 'Noto Serif JP', serif;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
    }

    .calc-btn:hover { opacity: 0.9; }
    .calc-btn:active { transform: scale(0.98); }

    /* ---- 結果表示 ---- */
    .result-box {
      margin-top: 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      min-height: 64px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .result-main {
      font-family: 'Noto Serif JP', serif;
      font-size: 1.7rem;
      font-weight: 700;
      color: var(--gold2);
      letter-spacing: 0.05em;
      text-align: center;
    }

    .result-sub {
      font-size: 0.82rem;
      color: var(--text-dim);
      margin-top: 5px;
      text-align: center;
    }

    .result-placeholder {
      color: var(--text-dim);
      font-size: 0.85rem;
      letter-spacing: 0.05em;
    }

    .result-error {
      color: var(--red);
      font-size: 0.9rem;
    }

    /* ========== レイアウト（手牌＋計算・副露エリア） ========== */
    .app-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 60px;
      align-items: flex-start;
    }

    .main-content {
      flex: 1;
      min-width: 280px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .meld-sidebar {
      width: 280px;
      flex-shrink: 0;
    }

    @media (max-width: 700px) {
      .app-wrap { flex-direction: column; padding: 16px 12px 40px; }
      .meld-sidebar { width: 100%; }
    }

    /* ========== 手牌選択（アコーディオン） ========== */
    .accordion-header {
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--gold2);
      letter-spacing: 0.08em;
      user-select: none;
      transition: background 0.2s;
    }

    .accordion-header:hover { background: var(--panel); }
    .accordion-header .arrow { transition: transform 0.25s; }
    .accordion-header.open .arrow { transform: rotate(180deg); }

    .accordion-body {
      display: none;
      padding: 12px 0 4px;
      border-bottom: 1px solid var(--border);
    }

    .accordion-body.open { display: block; }

    .accordion-item { margin-bottom: 4px; }
    .accordion-item:last-child { margin-bottom: 0; }

    .tile-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tile-btn {
      width: 44px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #2a3548;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 1.6rem;
      cursor: pointer;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
      color: #e8eef5;
      filter: brightness(1.15);
    }

    .tile-btn:hover {
      border-color: var(--gold);
      background: rgba(200,169,110,0.2);
      filter: brightness(1.25);
    }

    .tile-btn:active { transform: scale(0.96); }

    @media (max-width: 480px) {
      .tile-btn { width: 40px; height: 48px; font-size: 1.45rem; }
    }

    /* ========== 手牌エリア ========== */
    .hand-area-wrap {
      overflow-x: auto;
      margin-bottom: 4px;
    }

    .hand-area {
      min-height: 72px;
      min-width: 748px;
      padding: 14px;
      background: var(--bg);
      border: 1px dashed var(--border);
      border-radius: 8px;
      display: flex;
      flex-wrap: nowrap;
      gap: 8px;
      align-items: center;
      align-content: flex-start;
    }

    .hand-tile {
      width: 44px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--panel2);
      border: 2px solid var(--border);
      border-radius: 6px;
      font-size: 1.6rem;
      cursor: pointer;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
    }

    .hand-tile:hover { border-color: var(--gold); }
    .hand-tile.selected {
      border-color: var(--gold);
      background: rgba(200,169,110,0.25);
      box-shadow: 0 0 0 2px var(--gold);
    }

    @media (max-width: 480px) {
      .hand-tile { width: 40px; height: 48px; font-size: 1.45rem; }
      .hand-area { min-width: 692px; }
    }

    .furo-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .furo-btn {
      padding: 10px 18px;
      border-radius: 6px;
      border: 1px solid var(--gold);
      background: rgba(200,169,110,0.12);
      color: var(--gold2);
      font-size: 0.88rem;
      letter-spacing: 0.1em;
      cursor: pointer;
      transition: all 0.2s;
    }

    .furo-btn:hover { background: rgba(200,169,110,0.22); }
    .furo-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    /* ========== 副露エリア（右サイド） ========== */
    .meld-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      position: sticky;
      top: 20px;
    }

    .meld-card .card-header { padding: 10px 14px; }
    .meld-card .card-body { padding: 12px 14px; }

    .meld-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .meld-group {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 4px;
      padding: 8px 10px;
      background: var(--bg);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .meld-tile {
      width: 38px;
      height: 46px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 1.4rem;
      cursor: pointer;
      transition: transform 0.2s;
      -webkit-tap-highlight-color: transparent;
    }

    .meld-tile.called-from-0 { transform: rotate(-90deg); }   /* 上家 */
    .meld-tile.called-from-1 { transform: none; }            /* 対面 */
    .meld-tile.called-from-2 { transform: rotate(90deg); }   /* 下家 */

    .meld-tile-wrap {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      min-width: 46px;
      min-height: 50px;
    }

    .meld-tile-wrap .call-label {
      font-size: 0.55rem;
      color: var(--gold);
      margin-top: 2px;
      white-space: nowrap;
    }

    .meld-placeholder {
      color: var(--text-dim);
      font-size: 0.8rem;
      text-align: center;
      padding: 20px 10px;
      letter-spacing: 0.05em;
    }
  </style>
</head>
<body>

<header>
  <h1>麻 雀 点 数 計 算</h1>
  <p>雀魂 段位戦ルール対応</p>
</header>

<div class="app-wrap">
  <div class="main-content">

  <!-- 手牌選択 -->
  <div class="card">
    <div class="card-header"><div class="dot"></div><h2>手 牌 選 択</h2></div>
    <div class="card-body">
      <div class="accordion" id="tile_accordion">
        <div class="accordion-item">
          <div class="accordion-header" data-target="manzu">萬子 <span class="arrow">▼</span></div>
          <div class="accordion-body" id="manzu">
            <div class="tile-grid" id="grid_manzu"></div>
          </div>
        </div>
        <div class="accordion-item">
          <div class="accordion-header" data-target="pinzu">筒子 <span class="arrow">▼</span></div>
          <div class="accordion-body" id="pinzu">
            <div class="tile-grid" id="grid_pinzu"></div>
          </div>
        </div>
        <div class="accordion-item">
          <div class="accordion-header" data-target="souzu">索子 <span class="arrow">▼</span></div>
          <div class="accordion-body" id="souzu">
            <div class="tile-grid" id="grid_souzu"></div>
          </div>
        </div>
        <div class="accordion-item">
          <div class="accordion-header" data-target="jihai">字牌 <span class="arrow">▼</span></div>
          <div class="accordion-body" id="jihai">
            <div class="tile-grid" id="grid_jihai"></div>
          </div>
        </div>
      </div>
      <div style="margin-top:14px;">
        <div class="yaku-section-title">手牌エリア（最大14枚）</div>
        <p style="font-size:0.72rem;color:var(--text-dim);margin-bottom:6px;">クリックで選択（副露用）・ダブルクリックで1枚削除</p>
        <div class="hand-area-wrap">
          <div class="hand-area" id="hand_area"></div>
        </div>
        <div class="furo-actions">
          <button type="button" class="furo-btn" id="btn_furo">副露する</button>
          <button type="button" class="furo-btn" id="btn_clear_sel">選択解除</button>
          <button type="button" class="furo-btn" id="btn_remove_sel">選択牌を削除</button>
        </div>
      </div>
    </div>
  </div>

<div class="container" style="max-width:none;padding:0;">

  <!-- 役選択 -->
  <div class="card">
    <div class="card-header"><div class="dot"></div><h2>役 選 択</h2></div>
    <div class="card-body">

      <div class="menzen-row" style="margin-bottom:16px;">
        <div class="radio-btn">
          <input type="radio" name="menzen" id="m_menzen" value="menzen" checked onchange="updateYaku()">
          <label for="m_menzen">門 前</label>
        </div>
        <div class="radio-btn">
          <input type="radio" name="menzen" id="m_kui" value="kui" onchange="updateYaku()">
          <label for="m_kui">食 い</label>
        </div>
      </div>

      <div class="yaku-section">
        <div class="yaku-section-title">1 翻 役</div>
        <div class="yaku-grid">
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_riichi"  data-name="立直"        data-han="1" data-menzen="true" onchange="updateYaku()"><label for="y_riichi">立直</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_ippatsu" data-name="一発"        data-han="1" data-menzen="true" onchange="updateYaku()"><label for="y_ippatsu">一発</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_tsumo"   data-name="門清自摸"    data-han="1" data-menzen="true" onchange="updateYaku()"><label for="y_tsumo">門前清自摸和</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_pinfu"   data-name="平和"        data-han="1" data-menzen="true" onchange="updateYaku()"><label for="y_pinfu">平和</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_tanyao"  data-name="断幺九"      data-han="1" data-han-kui="1"   onchange="updateYaku()"><label for="y_tanyao">断幺九</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_iipeiko" data-name="一盃口"      data-han="1" data-menzen="true" onchange="updateYaku()"><label for="y_iipeiko">一盃口</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_haku"    data-name="白"          data-han="1" data-han-kui="1"   onchange="updateYaku()"><label for="y_haku">白</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_hatsu"   data-name="発"          data-han="1" data-han-kui="1"   onchange="updateYaku()"><label for="y_hatsu">発</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_chun"    data-name="中"          data-han="1" data-han-kui="1"   onchange="updateYaku()"><label for="y_chun">中</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_bakaze"  data-name="場風"        data-han="1" data-han-kui="1"   onchange="updateYaku()"><label for="y_bakaze">場風</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_jikaze"  data-name="自風"        data-han="1" data-han-kui="1"   onchange="updateYaku()"><label for="y_jikaze">自風</label></div>
        </div>
      </div>

      <div class="yaku-section">
        <div class="yaku-section-title">2 翻 役</div>
        <div class="yaku-grid">
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_daburi"      data-name="ダブル立直"   data-han="2" data-menzen="true" onchange="updateYaku()"><label for="y_daburi">ダブル立直</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_chanta"      data-name="混全帯幺九"   data-han="2" data-han-kui="1"   onchange="updateYaku()"><label for="y_chanta">混全帯幺九</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_ittsu"       data-name="一気通貫"     data-han="2" data-han-kui="1"   onchange="updateYaku()"><label for="y_ittsu">一気通貫</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_sanshoku"    data-name="三色同順"     data-han="2" data-han-kui="1"   onchange="updateYaku()"><label for="y_sanshoku">三色同順</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_sanshokudou" data-name="三色同刻"     data-han="2" data-han-kui="2"   onchange="updateYaku()"><label for="y_sanshokudou">三色同刻</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_toitoi"      data-name="対々和"       data-han="2" data-han-kui="2"   onchange="updateYaku()"><label for="y_toitoi">対々和</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_sanankou"    data-name="三暗刻"       data-han="2" data-han-kui="2"   onchange="updateYaku()"><label for="y_sanankou">三暗刻</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_shosangen"   data-name="小三元"       data-han="2" data-han-kui="2"   onchange="updateYaku()"><label for="y_shosangen">小三元</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_honroto"     data-name="混老頭"       data-han="2" data-han-kui="2"   onchange="updateYaku()"><label for="y_honroto">混老頭</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_chiitoitsu"  data-name="七対子"       data-han="2" data-menzen="true" data-special="chiitoitsu" onchange="updateYaku()"><label for="y_chiitoitsu">七対子</label></div>
        </div>
      </div>

      <div class="yaku-section">
        <div class="yaku-section-title">3 翻 役</div>
        <div class="yaku-grid">
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_ryanpeiko" data-name="二盃口"   data-han="3" data-menzen="true" onchange="updateYaku()"><label for="y_ryanpeiko">二盃口</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_junchan"   data-name="純全帯幺九" data-han="3" data-han-kui="2" onchange="updateYaku()"><label for="y_junchan">純全帯幺九</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_honitsu"   data-name="混一色"   data-han="3" data-han-kui="2" onchange="updateYaku()"><label for="y_honitsu">混一色</label></div>
        </div>
      </div>

      <div class="yaku-section">
        <div class="yaku-section-title">6 翻 役</div>
        <div class="yaku-grid">
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_chinitsu" data-name="清一色" data-han="6" data-han-kui="5" onchange="updateYaku()"><label for="y_chinitsu">清一色</label></div>
        </div>
      </div>

      <div class="yaku-section yakuman">
        <div class="yaku-section-title" style="color:var(--red);border-color:rgba(224,90,90,0.3);">役 満</div>
        <div class="yaku-grid">
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_kokushi"    data-name="国士無双"   data-han="13" data-menzen="true" onchange="updateYaku()"><label for="y_kokushi">国士無双</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_suankou"    data-name="四暗刻"     data-han="13" data-menzen="true" onchange="updateYaku()"><label for="y_suankou">四暗刻</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_daisangen"  data-name="大三元"     data-han="13" data-han-kui="13"  onchange="updateYaku()"><label for="y_daisangen">大三元</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_shosushi"   data-name="小四喜"     data-han="13" data-han-kui="13"  onchange="updateYaku()"><label for="y_shosushi">小四喜</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_daisushi"   data-name="大四喜"     data-han="13" data-han-kui="13"  onchange="updateYaku()"><label for="y_daisushi">大四喜</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_tsuiso"     data-name="字一色"     data-han="13" data-han-kui="13"  onchange="updateYaku()"><label for="y_tsuiso">字一色</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_ryuiso"     data-name="緑一色"     data-han="13" data-han-kui="13"  onchange="updateYaku()"><label for="y_ryuiso">緑一色</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_chinroto"   data-name="清老頭"     data-han="13" data-han-kui="13"  onchange="updateYaku()"><label for="y_chinroto">清老頭</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_churenpoton" data-name="九蓮宝燈" data-han="13" data-menzen="true" onchange="updateYaku()"><label for="y_churenpoton">九蓮宝燈</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_tenho"      data-name="天和"       data-han="13" data-menzen="true" onchange="updateYaku()"><label for="y_tenho">天和</label></div>
          <div class="yaku-check"><input type="checkbox" class="yaku" id="y_chiho"      data-name="地和"       data-han="13" data-menzen="true" onchange="updateYaku()"><label for="y_chiho">地和</label></div>
        </div>
      </div>

      <div class="han-bar">
        <div>
          <div class="label">合計翻数</div>
          <div class="yaku-names" id="yaku_names">役なし</div>
        </div>
        <div class="value" id="han_display">0翻</div>
      </div>

    </div>
  </div>

  <!-- 点数計算 -->
  <div class="card">
    <div class="card-header"><div class="dot"></div><h2>点 数 計 算</h2></div>
    <div class="card-body">

      <div class="form-grid">
        <div class="form-item">
          <label>翻数</label>
          <input type="number" id="han" placeholder="例：3" min="1">
        </div>
        <div class="form-item">
          <label>符（満貫以上は不要）</label>
          <input type="number" id="fu" placeholder="例：40" min="20">
        </div>
        <div class="form-item">
          <label>本場</label>
          <input type="number" id="honba" value="0" min="0">
        </div>
        <div class="form-item">
          <label>場のリーチ棒</label>
          <input type="number" id="riichi_ba" value="0" min="0">
        </div>
        <div class="form-item">
          <label>持ち越し供託</label>
          <input type="number" id="riichi_kuyaku" value="0" min="0">
        </div>
      </div>

      <div class="form-row" style="margin-top:16px;">
        <div class="toggle-group">
          <div class="radio-btn">
            <input type="radio" name="oya" id="r_ko" value="ko" checked>
            <label for="r_ko">子</label>
          </div>
          <div class="radio-btn">
            <input type="radio" name="oya" id="r_oya" value="oya">
            <label for="r_oya">親</label>
          </div>
        </div>
        <div class="toggle-group">
          <div class="radio-btn">
            <input type="radio" name="agari" id="r_ron" value="ron" checked>
            <label for="r_ron">ロン</label>
          </div>
          <div class="radio-btn">
            <input type="radio" name="agari" id="r_tsumo" value="tsumo">
            <label for="r_tsumo">ツモ</label>
          </div>
        </div>
      </div>

      <button class="calc-btn" onclick="keisan()">計 算 す る</button>

      <div class="result-box" id="result_box">
        <span class="result-placeholder">結果がここに表示されます</span>
      </div>

    </div>
  </div>

  </div>
  </div>

  <!-- 副露エリア（右側） -->
  <aside class="meld-sidebar">
    <div class="meld-card">
      <div class="card-header"><div class="dot"></div><h2>副 露 エ リア</h2></div>
      <div class="card-body">
        <div class="meld-list" id="meld_list"></div>
        <div class="meld-placeholder" id="meld_placeholder">手牌で牌を選択し「副露する」でここに移動します。<br>牌をクリックで上家・対面・下家を切り替え。</div>
      </div>
    </div>
  </aside>

</div>

<script>
  // ========== 牌データ（Unicode） ==========
  var TILES = {
    manzu: [0x1F007,0x1F008,0x1F009,0x1F00A,0x1F00B,0x1F00C,0x1F00D,0x1F00E,0x1F00F],
    pinzu: [0x1F019,0x1F01A,0x1F01B,0x1F01C,0x1F01D,0x1F01E,0x1F01F,0x1F020,0x1F021],
    souzu: [0x1F010,0x1F011,0x1F012,0x1F013,0x1F014,0x1F015,0x1F016,0x1F017,0x1F018],
    jihai: [0x1F000,0x1F001,0x1F002,0x1F003,0x1F004,0x1F005,0x1F006]
  };
  var JIHAI_NAMES = ['東','南','西','北','中','発','白'];

  function renderTilePicker() {
    ['manzu','pinzu','souzu'].forEach(function(cat) {
      var grid = document.getElementById('grid_' + cat);
      if (!grid) return;
      grid.innerHTML = '';
      var arr = TILES[cat];
      for (var i = 0; i < arr.length; i++) {
        var btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'tile-btn';
        btn.textContent = String.fromCodePoint(arr[i]);
        btn.dataset.cat = cat;
        btn.dataset.num = i + 1;
        btn.dataset.unicode = arr[i];
        btn.onclick = function() { addToHand(this.dataset.cat, parseInt(this.dataset.num, 10), parseInt(this.dataset.unicode, 10)); };
        grid.appendChild(btn);
      }
    });
    var jg = document.getElementById('grid_jihai');
    if (jg) {
      jg.innerHTML = '';
      for (var j = 0; j < TILES.jihai.length; j++) {
        var b = document.createElement('button');
        b.type = 'button';
        b.className = 'tile-btn';
        b.textContent = String.fromCodePoint(TILES.jihai[j]);
        b.dataset.cat = 'jihai';
        b.dataset.num = String(j + 1);
        b.dataset.unicode = TILES.jihai[j];
        b.onclick = function() { addToHand('jihai', parseInt(this.dataset.num, 10), parseInt(this.dataset.unicode, 10)); };
        jg.appendChild(b);
      }
    }
  }

  var handTiles = [];
  var handTileId = 0;
  var selectedHandIndices = new Set();
  var meldGroups = [];

  function addToHand(cat, num, unicode) {
    if (handTiles.length >= 14) return;
    var id = ++handTileId;
    var name = (cat === 'jihai') ? JIHAI_NAMES[num - 1] : (cat === 'manzu' ? num + '萬' : cat === 'pinzu' ? num + '筒' : num + '索');
    handTiles.push({ id: id, cat: cat, num: num, unicode: unicode, name: name });
    renderHand();
  }

  function removeFromHand(index) {
    handTiles.splice(index, 1);
    selectedHandIndices.clear();
    renderHand();
  }

  function toggleHandSelection(index) {
    if (selectedHandIndices.has(index)) selectedHandIndices.delete(index);
    else selectedHandIndices.add(index);
    renderHand();
  }

  function renderHand() {
    var area = document.getElementById('hand_area');
    area.innerHTML = '';
    handTiles.forEach(function(t, i) {
      var el = document.createElement('button');
      el.type = 'button';
      el.className = 'hand-tile' + (selectedHandIndices.has(i) ? ' selected' : '');
      el.textContent = String.fromCodePoint(t.unicode);
      el.dataset.index = i;
      el.onclick = function(ev) {
        ev.preventDefault();
        var idx = parseInt(this.dataset.index, 10);
        toggleHandSelection(idx);
      };
      el.ondblclick = function(ev) {
        ev.preventDefault();
        var idx = parseInt(this.dataset.index, 10);
        selectedHandIndices.delete(idx);
        removeFromHand(idx);
      };
      area.appendChild(el);
    });
    document.getElementById('btn_furo').disabled = selectedHandIndices.size < 3 || selectedHandIndices.size > 4;
  }

  document.getElementById('btn_clear_sel').onclick = function() {
    selectedHandIndices.clear();
    renderHand();
  };

  document.getElementById('btn_remove_sel').onclick = function() {
    if (selectedHandIndices.size === 0) return;
    var indices = Array.from(selectedHandIndices).sort(function(a,b){ return b - a; });
    indices.forEach(function(i) { handTiles.splice(i, 1); });
    selectedHandIndices.clear();
    renderHand();
  };

  document.getElementById('btn_furo').onclick = function() {
    if (selectedHandIndices.size < 3 || selectedHandIndices.size > 4) return;
    var indices = Array.from(selectedHandIndices).sort(function(a,b){ return a - b; });
    var tiles = indices.map(function(i) { return Object.assign({}, handTiles[i]); });
    meldGroups.push({ tiles: tiles, calledIndex: 0, calledFrom: 0 });
    for (var i = indices.length - 1; i >= 0; i--) handTiles.splice(indices[i], 1);
    selectedHandIndices.clear();
    renderHand();
    renderMelds();
  };

  var CALL_LABELS = ['上家','対面','下家'];

  function renderMelds() {
    var list = document.getElementById('meld_list');
    var placeholder = document.getElementById('meld_placeholder');
    list.innerHTML = '';
    if (meldGroups.length === 0) {
      placeholder.style.display = 'block';
      return;
    }
    placeholder.style.display = 'none';
    meldGroups.forEach(function(group, gIdx) {
      var wrap = document.createElement('div');
      wrap.className = 'meld-group';
      group.tiles.forEach(function(tile, tIdx) {
        var tw = document.createElement('div');
        tw.className = 'meld-tile-wrap';
        var span = document.createElement('span');
        var isCalled = tIdx === group.calledIndex;
        span.className = 'meld-tile' + (isCalled ? ' called-from-' + group.calledFrom : '');
        span.textContent = String.fromCodePoint(tile.unicode);
        span.dataset.g = gIdx;
        span.dataset.t = tIdx;
        span.onclick = function() {
          var g = parseInt(this.dataset.g, 10);
          var t = parseInt(this.dataset.t, 10);
          if (meldGroups[g].calledIndex !== t) {
            meldGroups[g].calledIndex = t;
            meldGroups[g].calledFrom = 0;
          } else {
            meldGroups[g].calledFrom = (meldGroups[g].calledFrom + 1) % 3;
          }
          renderMelds();
        };
        tw.appendChild(span);
        if (isCalled) {
          var lbl = document.createElement('span');
          lbl.className = 'call-label';
          lbl.textContent = CALL_LABELS[group.calledFrom];
          tw.appendChild(lbl);
        }
        wrap.appendChild(tw);
      });
      list.appendChild(wrap);
    });
  }

  document.querySelectorAll('#tile_accordion .accordion-header').forEach(function(h) {
    h.onclick = function() {
      var target = document.getElementById(this.dataset.target);
      var isOpen = target.classList.contains('open');
      document.querySelectorAll('#tile_accordion .accordion-body').forEach(function(b) { b.classList.remove('open'); });
      document.querySelectorAll('#tile_accordion .accordion-header').forEach(function(h2) { h2.classList.remove('open'); });
      if (!isOpen) { target.classList.add('open'); this.classList.add('open'); }
    };
  });
  document.querySelector('#tile_accordion .accordion-header').click();

  renderTilePicker();
  renderHand();
  renderMelds();

  function updateYaku() {
    var isKui = document.querySelector('input[name="menzen"]:checked').value === "kui";
    var checkboxes = document.querySelectorAll('.yaku');
    var totalHan = 0;
    var yakuList = [];
    var isChiitoitsu = false;

    checkboxes.forEach(function(cb) {
      if (isKui && cb.dataset.menzen === "true") {
        cb.disabled = true;
        cb.checked = false;
        return;
      } else {
        cb.disabled = false;
      }
      if (!cb.checked) return;

      var han = (isKui && cb.dataset.hanKui !== undefined)
        ? Number(cb.dataset.hanKui)
        : Number(cb.dataset.han);

      totalHan += han;
      yakuList.push(cb.dataset.name);
      if (cb.dataset.special === "chiitoitsu") isChiitoitsu = true;
    });

    document.getElementById("han_display").textContent = totalHan + "翻";
    document.getElementById("yaku_names").textContent  = yakuList.length > 0 ? yakuList.join("・") : "役なし";
    document.getElementById("han").value = totalHan > 0 ? totalHan : "";
    if (isChiitoitsu) document.getElementById("fu").value = 25;
  }

  function ceil100(n) { return Math.ceil(n / 100) * 100; }
  function kihouten(fu, han) { return fu * Math.pow(2, han + 2); }

  function showResult(main, sub) {
    var box = document.getElementById("result_box");
    box.innerHTML =
      '<div class="result-main">' + main + '</div>' +
      (sub ? '<div class="result-sub">' + sub + '</div>' : '');
  }

  function showError(msg) {
    var box = document.getElementById("result_box");
    box.innerHTML = '<div class="result-error">' + msg + '</div>';
  }

  function keisan() {
    var han           = Number(document.getElementById("han").value);
    var fu            = Number(document.getElementById("fu").value);
    var honba         = Number(document.getElementById("honba").value) || 0;
    var riichi_ba     = Number(document.getElementById("riichi_ba").value) || 0;
    var riichi_kuyaku = Number(document.getElementById("riichi_kuyaku").value) || 0;
    var isOya         = document.querySelector('input[name="oya"]:checked').value === "oya";
    var agari         = document.querySelector('input[name="agari"]:checked').value;

    var riichiTotal = (riichi_ba + riichi_kuyaku) * 1000;
    var riichiText  = riichiTotal > 0 ? "　供託 +" + riichiTotal + "点" : "";

    if (!han || han < 1) { showError("翻数を入力してください"); return; }

    var manganKo       = [8000,  12000, 16000, 24000, 32000];
    var manganOya      = [12000, 18000, 24000, 36000, 48000];
    var manganName     = ["満貫", "跳満", "倍満", "三倍満", "役満"];
    var tsumoKoDetail  = ["親4000・子2000 × 2", "親6000・子3000 × 2", "親8000・子4000 × 2", "親12000・子6000 × 2", "親16000・子8000 × 2"];
    var tsumoOyaDetail = ["子4000 × 3", "子6000 × 3", "子8000 × 3", "子12000 × 3", "子16000 × 3"];

    var manganIdx = -1;
    if      (han >= 13) manganIdx = 4;
    else if (han >= 11) manganIdx = 3;
    else if (han >= 8)  manganIdx = 2;
    else if (han >= 6)  manganIdx = 1;
    else if (han >= 5)  manganIdx = 0;

    if (manganIdx >= 0) {
      var score  = isOya ? manganOya[manganIdx] : manganKo[manganIdx];
      var detail = isOya ? tsumoOyaDetail[manganIdx] : tsumoKoDetail[manganIdx];
      var total  = score + honba * 300 + riichiTotal;
      var sub    = agari === "tsumo" ? detail : "ロン";
      if (honba > 0) sub += "　本場 +" + (honba * 300) + "点";
      sub += riichiText;
      showResult(manganName[manganIdx] + " " + total.toLocaleString() + "点", sub);
      return;
    }

    if (!fu || fu < 20) { showError("符を入力してください"); return; }
    if (isOya && (fu === 20 || fu === 25)) { showError("親に20符・25符は存在しません"); return; }
    if (fu === 20 && agari === "ron")      { showError("20符はツモのみです（ロン不可）"); return; }
    if (fu === 20 && han < 2)             { showError("20符は2翻以上から成立します"); return; }

    var kihon      = kihouten(fu, han);
    var manganLine = isOya ? 12000 : 8000;

    if (agari === "ron") {
      var score = ceil100(kihon * (isOya ? 6 : 4));
      if (score >= manganLine) {
        var total = manganLine + honba * 300 + riichiTotal;
        var sub   = "切り上げ満貫　ロン";
        if (honba > 0) sub += "　本場 +" + (honba * 300) + "点";
        sub += riichiText;
        showResult(total.toLocaleString() + "点", sub);
        return;
      }
      var total = score + honba * 300 + riichiTotal;
      var sub   = fu + "符 " + han + "翻　ロン";
      if (honba > 0) sub += "　本場 +" + (honba * 300) + "点";
      sub += riichiText;
      showResult(total.toLocaleString() + "点", sub);

    } else {
      var score, detail;
      if (isOya) {
        var koPay = ceil100(kihon * 2);
        score  = koPay * 3;
        detail = "子 " + (koPay + honba * 100) + "点 × 3";
      } else {
        var oyaPay = ceil100(kihon * 2);
        var koPay  = ceil100(kihon);
        score  = oyaPay + koPay * 2;
        detail = "親 " + (oyaPay + honba * 100) + "点・子 " + (koPay + honba * 100) + "点 × 2";
      }
      if (score >= manganLine) {
        var mDetail = isOya
          ? "子 " + (manganLine / 3 + honba * 100) + "点 × 3"
          : "親 " + (manganLine / 2 + honba * 100) + "点・子 " + (manganLine / 4 + honba * 100) + "点 × 2";
        var total = manganLine + honba * 300 + riichiTotal;
        var sub   = "切り上げ満貫　" + mDetail + riichiText;
        showResult(total.toLocaleString() + "点", sub);
        return;
      }
      var total = score + honba * 300 + riichiTotal;
      var sub   = fu + "符 " + han + "翻　" + detail + riichiText;
      showResult(total.toLocaleString() + "点", sub);
    }
  }
</script>

</body>
</html>